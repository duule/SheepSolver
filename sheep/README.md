# SheepSolver

这是一个用于《羊了个羊》游戏的高效并行求解器，能够自动搜索并找到通关解决方案。

## 环境要求

- Python 3.6 或更高版本
- 标准库依赖：无需安装额外第三方库，仅使用Python内置模块
  - json: 处理地图数据和保存解决方案
  - os: 系统操作（清屏等）
  - copy: 复制数据结构
  - time: 计时和延时
  - hashlib: 生成状态标识
  - queue: 任务队列管理
  - concurrent.futures: 线程池实现并行计算
  - collections: 提供Counter等数据结构

## 安装方法

1. 确保已安装Python 3.6或更高版本
2. 克隆或下载本项目文件
3. 确保`map_data.json`文件与`solver.py`在同一目录下

## 使用方式

### 基本使用

在项目目录下运行以下命令：

```bash
python solver.py
```

程序将自动加载`map_data.json`中的地图数据，并使用所有可用的CPU核心进行并行求解。

### 自定义线程数

如果需要限制使用的CPU核心数，可以修改`main()`函数中的初始化代码：

```python
# 使用8个线程（默认为所有可用核心）
solver = SheepSolver('map_data.json', 8)
```

## 结果展示

在当前map_data.json数据的情况下，程序运行结果如下：

```
解决方案总步数: 267
解决方案已保存到solution.json
求解完成，总耗时: 273.11秒
总共访问状态数: 174893
总共处理状态数: 447999
使用的线程数: 24
```

`solution.json`中可查看解决方案的详细信息，包括点击步骤序列、总步数和求解时间等。

## 程序用途

- 自动搜索《羊了个羊》游戏的通关解决方案
- 生成并保存完整的点击步骤序列
- 提供实时搜索进度可视化
- 分析游戏状态空间和复杂度

## 算法说明

### 核心算法

本求解器使用基于**广度优先搜索(BFS)**的启发式搜索算法，结合以下关键技术：

1. **并行计算**：利用多线程同时处理多个游戏状态
2. **贪心策略**：优先选择更可能导致成功的卡片点击顺序
3. **状态剪枝**：避免重复搜索已访问过的状态
4. **任务队列**：使用优先级队列管理待处理的游戏状态

### 优先级策略

算法根据以下规则确定卡片点击优先级：

- 优先选择槽位中已有2个的相同类型卡片
- 优先选择槽位中已有该类型的卡片
- 优先选择剩余数量多的卡片类型
- 优先选择层数较高的卡片
- 当槽位即将填满时，优先选择能消除的卡片

## 算法优缺点

### 优点

1. **高效性**：通过并行计算大幅提高搜索速度
2. **完整性**：理论上能找到所有可能的解决方案
3. **可优化**：易于调整优先级策略和搜索参数
4. **低依赖**：仅使用Python标准库，无需额外安装
5. **可扩展性**：架构清晰，便于添加新功能

### 缺点

1. **内存消耗**：对于复杂地图，可能需要存储大量状态
2. **时间复杂度**：在极端情况下，搜索空间可能变得非常庞大
3. **固定策略**：当前贪心策略可能不适应所有地图布局
4. **无学习能力**：不会从之前的求解经验中学习

## 适用场景

1. **个人游戏辅助**：帮助玩家快速通关《羊了个羊》
2. **游戏分析**：研究游戏难度和状态空间特性
3. **算法学习**：作为并行搜索和启发式算法的教学示例
4. **效率测试**：测试不同硬件配置下的计算性能
5. **游戏设计参考**：为类似匹配消除游戏提供算法参考

## 输出结果

程序找到解决方案后，将生成以下输出：

1. 控制台输出：显示解决方案的总步数和求解统计信息
2. JSON文件：将解决方案保存到`solution.json`文件中，包含：
   - 完整的点击步骤序列
   - 总步数统计
   - 求解时间戳
   - 使用的线程数

## 注意事项

- 求解时间取决于地图复杂度和硬件性能
- 对于特别复杂的地图，可能需要较长时间或无法在合理时间内找到解
- 按Ctrl+C可随时中断求解过程
- 程序使用的碰撞检测规则可能需要根据实际游戏规则进行调整

## 展望

1. 添加更智能的启发式函数以提高搜索效率
2. 实现状态压缩以减少内存占用
3. 添加缓存机制，保存已解决地图的解决方案
4. 开发图形界面，直观展示搜索过程和解决方案
5. 支持从游戏中实时提取地图数据

## 参考

[BugMaker888/sheep](https://github.com/BugMaker888/sheep) : 在开发过程中使用了该项目的3D可视化、mitm抓包以及基于抓包后的数据结构进行了本项目的开发，本项目解出的解同样可以在BugMaker888的可视化程序中进行展示。



## License

- 本项目采用MIT许可证 - 详见 <mcfile name="LICENSE" path="./LICENSE"></mcfile> 文件